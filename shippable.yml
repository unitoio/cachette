language: node_js 
node_js:
  - 10.15.1

services:
  - redis

env:
  global:
    # The path for Xunit to output test reports
    - XUNIT_FILE=shippable/testresults/result.xml
    - LC_ALL=C
    - TEST_REDIS_URL=redis://localhost:6379
    # UNITO_NPM_REGISTRY_TOKEN
    - secure: YgtvJvQjC84IuKueXHF+5ZB1Dx+5PnFxGPcyrB4B83JMmGREXuUWPvfF1MSYpu/20Blz7lEmblt3CLPEoxBe3yUtHagFflkaEF/w01sDHZJ3+F5yUXV6kUyGTcncrrsby189vdPuEcOUmSc5RkxsYMA8YoCYEnlwVgGW5KLYGYsC8YJVa9WcJ4r+E2lQN7xHdgRARuM4/Dz8d2W2tgkSmalebIqFV5RVkwas8F0r8bs/nMPNiR7VxgiYzo9B+KnZ4ndHqhzkESb7IM63LvRuZry9hujO9r98DrcQcfgB5asLWg7VOzvZOVH7t1XOa38NVdZUJUibkynCMNtj819Ulg==

branches:
  only:
    - master

build:
  ci:
    - shippable_retry npm ci
    - npm run audit
    - npm run lint
    - npm run test:ci
    - npm run publish-to-npm

integrations:
  notifications:
    - integrationName: email
      type: email
      recipients:
        - dev@unito.io
      on_failure: always
      on_success: never
      on_pull_request: never
      on_start: never
